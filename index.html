<!DOCTYPE html>



  


<html class="theme-next muse use-motion" lang="">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="Hexo, NexT" />










<meta name="description" content="前端小码农,没事看看源码,整整小程序,用用vue,研究研究webpack,学习学习node.js">
<meta name="keywords" content="前端工程师">
<meta property="og:type" content="website">
<meta property="og:title" content="佛系编程">
<meta property="og:url" content="http://yoursite.com/index.html">
<meta property="og:site_name" content="佛系编程">
<meta property="og:description" content="前端小码农,没事看看源码,整整小程序,用用vue,研究研究webpack,学习学习node.js">
<meta property="og:locale" content="default">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="佛系编程">
<meta name="twitter:description" content="前端小码农,没事看看源码,整整小程序,用用vue,研究研究webpack,学习学习node.js">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Muse',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: 'Author'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/"/>





  <title>佛系编程</title>
  








</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="default">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">佛系编程</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">缘分到了,代码自然就躺好了</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            Home
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            Archives
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/11/19/混合开发之uni-app/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="NicolasSingle">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="佛系编程">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/11/19/混合开发之uni-app/" itemprop="url">混合开发之uni-app</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2019-11-19T00:00:00+08:00">
                2019-11-19
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="uni-app介绍"><a href="#uni-app介绍" class="headerlink" title="uni-app介绍"></a>uni-app介绍</h2><blockquote>
<p>uni-app是一个使用 Vue.js 开发所有前端应用的框架，开发者编写一套代码，可发布到iOS、Android、H5、以及各种小程序（微信/支付宝/百度/头条/QQ/钉钉）等多个平台。</p>
</blockquote>
<h2 id="uni-app功能框架"><a href="#uni-app功能框架" class="headerlink" title="uni-app功能框架"></a>uni-app功能框架</h2><p><img src="https://img-cdn-qiniu.dcloud.net.cn/uniapp/doc/uni0124.png" alt="功能框架"><br><strong>通过调用各平台专有能力，实现多端统一</strong></p>
<h2 id="Weex-nvue"><a href="#Weex-nvue" class="headerlink" title="Weex/nvue"></a>Weex/nvue</h2><p>uni-app App端内置weex渲染引擎，提供原生渲染能力</p>
<h3 id="什么是Weex"><a href="#什么是Weex" class="headerlink" title="什么是Weex"></a>什么是Weex</h3><blockquote>
<p>Weex 是使用流行的 Web 开发体验来开发高性能原生应用的框架。</p>
</blockquote>
<p>然而，<strong>Weex并不是一个前端框架</strong>。实际上，前端框架仅仅是 Weex 的语法层或称之为 DSL (Domain-specific Language)，它们与原生渲染引擎是分离的。换句话说，Weex 并不依赖于特定的前端框架，随着前端技术的发展，Weex 也可以集成更多广泛使用的前端框架。</p>
<h3 id="什么是nvue"><a href="#什么是nvue" class="headerlink" title="什么是nvue"></a>什么是nvue</h3><blockquote>
<p><strong>nvue</strong> 相当于给 weex 补充了大量 uni-app 的组件和api，以及丰富的 Plus API、Native.js、原生插件。</p>
</blockquote>
<p>以往的 weex ，有个很大的问题是它只是一个高性能的渲染器，没有足够的API能力，使得开发时非常依赖原生工程师协作，开发者本来想节约成本，结果需要前端、iOS、Android 3拨人开发，适得其反。而 nvue 解决了这个大问题，让前端工程师可以直接开发完整 App，并提供原生插件的市场交易和云打包。这些组合方案，开发者切实的提高效率、降低成本。</p>
<p><strong>如果你是web前端，不熟悉 weex，那么建议你仍然以使用 vue 为主，在App端某些 vue 表现不佳的场景下使用 nvue 作为强化补充：</strong></p>
<ul>
<li>左右拖动的长列表。在webview里，通过swiper+scroll-view实现左右拖动的长列表，前端模拟下拉刷新，这套方案的性能不好。此时推荐使用nvue，比如新建uni-app项目时的新闻示例模板，就是首页采用了nvue</li>
<li>如需要将软键盘右下角按钮文字改为“发送”，则需要使用nvue</li>
<li>前端控件无法覆盖原生控件的问题。在nvue下，都是原生控件，覆盖map、video等不需要cover-view（如需要发布到小程序，仍然推荐写cover-view）</li>
<li>同样因为层级问题得到解决，nvue可以实现video内嵌到swiper中，以实现抖音式视频滑动切换，例子见插件市场；nvue的视频全屏后，仍然可以通过cover-view实现内容覆盖，比如增加文字标题、分享按钮。</li>
<li>nvue下有live-pusher组件，和小程序对齐。而vue页面下使用直播，需在条件编译里单独调用plus.video的API。</li>
<li>App端nvue文件的map和小程序拉齐度更高。vue里的map则与plus.map功能一致，和小程序的地图略有差异。</li>
<li>App端实现粘性布局，比如滚动吸顶，则nvue才能保证高性能，例子见插件市场</li>
<li>此外，App端，vue页面上也可以覆盖subnvue（一种非全屏的nvue页面覆盖在webview上），以解决App上的原生控件层级问题。</li>
</ul>
<h2 id="什么是HTML5"><a href="#什么是HTML5" class="headerlink" title="什么是HTML5+"></a>什么是HTML5+</h2><blockquote>
<p>给浏览器赋能，给HTML提供原生api，让HTML5达到原生水平！如：微信的jsapi，H5+联盟等。</p>
</blockquote>
<p><strong>uni-app App 端内置 HTML5+ 引擎，让 js 可以直接调用丰富的原生能力。</strong></p>
<ul>
<li>条件编译调用 HTML5+</li>
</ul>
<p>小程序及 H5 等平台是没有 HTML5+ 扩展规范的，因此在 uni-app 调用 HTML5+ 的扩展规范时，需要注意使用条件编译。否则运行到h5、小程序等平台会出现 plus is not defined错误。</p>
<ul>
<li><p>uni-app不需要 plus ready 在html中使用plus的api，需要等待plus ready。 而uni-app不需要等，可以直接使用。而且如果你调用plus ready，反而不会触发。</p>
</li>
<li><p>uni-app 中的事件监听</p>
</li>
</ul>
<p>在普通的 H5+ 项目中，需要使用 document.addEventListener 监听原生扩展的事件。</p>
<p><strong>uni-app</strong>中，没有 document。可以使用 plus.globalEvent.addEventListener 来实现（注意manifest中需开启新编译器，即自定义组件模式”usingComponents”:true）。</p>
<p>同理，在 uni-app 中使用 Native.js 时，一些 Native.js 中对于原生事件的监听同样需要按照上面的方法去实现。</p>
<p>注意：旧编译器（非自定义组件模式）不支持 plus.globalEvent 这个对象。</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/10/22/微信生态圈这点事儿(微信H5登录)/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="NicolasSingle">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="佛系编程">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/10/22/微信生态圈这点事儿(微信H5登录)/" itemprop="url">微信生态圈这点事儿(微信H5登录)</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2019-10-22T00:00:00+08:00">
                2019-10-22
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="微信H5登录"><a href="#微信H5登录" class="headerlink" title="微信H5登录"></a>微信H5登录</h2><p><strong>起源:</strong> 起源这块不必多说, 微信生态没有登录, 宛若斗鱼没有主播, IG没有the shy。  </p>
<h3 id="产品需要做的"><a href="#产品需要做的" class="headerlink" title="产品需要做的"></a>产品需要做的</h3><ol>
<li>登陆公众号，开发 - 接口权限 - 网页服务 - 网页帐号 - 网页授权获取用户基本信息 设置 授权回调域名<ul>
<li>注意：这里额外需要传一个txt文件到域名对应的服务器上（微信的安全考虑）</li>
</ul>
</li>
<li>同样的,跟微信H5分享一样需要绑定后端服务器的ip白名单,在微信后台进入“开发”的IP白名单里添加一个后端服务器的ip，<br>通过开发者ID及密码调用获取access_token接口时，需要设置访问来源IP为白名单。</li>
</ol>
<blockquote>
<p>Talk is cheap. Show me the code.</p>
</blockquote>
<h3 id="前端需要做-敲-的"><a href="#前端需要做-敲-的" class="headerlink" title="前端需要做(敲)的"></a>前端需要做(敲)的</h3><p><strong>微信登录分为两种:</strong> 静默登陆和非静默登录</p>
<ul>
<li><p>静默登陆<br>以snsapi_base为scope发起的网页授权，是用来获取进入页面的用户的openid的，并且是静默授权并自动跳转到回调页的。用户感知的就是直接进入了回调页（往往是业务页面）</p>
</li>
<li><p>非静默登陆<br>以snsapi_userinfo为scope发起的网页授权，是用来获取用户的基本信息的。但这种授权需要用户手动同意，并且由于用户同意过，所以无须关注，就可在授权后获取该用户的基本信息。</p>
</li>
</ul>
<p><strong>关于特殊场景下的静默授权</strong></p>
<p>1、上面已经提到，对于以snsapi_base为scope的网页授权，就静默授权的，用户无感知；</p>
<p>2、对于已关注公众号的用户，如果用户从公众号的会话或者自定义菜单进入本公众号的网页授权页，即使是scope为snsapi_userinfo，也是静默授权，用户无感知。</p>
<p><strong>具体而言，网页授权流程分为四步:</strong></p>
<p>1、引导用户进入授权页面同意授权，获取code</p>
<p>2、通过code换取网页授权access_token（与基础支持中的access_token不同）</p>
<p>3、如果需要，开发者可以刷新网页授权access_token，避免过期</p>
<p>4、通过网页授权access_token和openid获取用户基本信息（支持UnionID机制）</p>
<p><strong>具体代码:</strong><br>utils-login.js</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> wxLogin = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">let</span> url = <span class="built_in">window</span>.location.href;</span><br><span class="line">  <span class="keyword">let</span> defaultConfig = <span class="built_in">Object</span>.assign(&#123;&#125;, &#123;</span><br><span class="line">    redirect_uri: url,</span><br><span class="line">    scope: <span class="string">"snsapi_userinfo"</span>, <span class="comment">// 如果静默登陆用snsapi_base</span></span><br><span class="line">    state: <span class="number">0</span>,</span><br><span class="line">    response_type: <span class="string">"code"</span>,</span><br><span class="line">    appId: webappid</span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">let</span> wxLoginUrl =</span><br><span class="line">    <span class="string">"https://open.weixin.qq.com/connect/oauth2/authorize?appid="</span> +</span><br><span class="line">    defaultConfig.appId +</span><br><span class="line">    <span class="string">"&amp;redirect_uri="</span> +</span><br><span class="line">    <span class="built_in">encodeURIComponent</span>(defaultConfig.redirect_uri) +</span><br><span class="line">    <span class="string">"&amp;response_type="</span> +</span><br><span class="line">    defaultConfig.response_type +</span><br><span class="line">    <span class="string">"&amp;scope="</span> +</span><br><span class="line">    defaultConfig.scope +</span><br><span class="line">    <span class="string">"&amp;state="</span> +</span><br><span class="line">    defaultConfig.state +</span><br><span class="line">    <span class="string">"#wechat_redirect"</span>;</span><br><span class="line"></span><br><span class="line">  <span class="built_in">window</span>.location.href = wxLoginUrl;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>pages  login.vue(login.html)</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> code = getQueryString(<span class="string">"code"</span>);</span><br><span class="line"><span class="keyword">if</span> (code) &#123;</span><br><span class="line">  <span class="keyword">let</span> userData = <span class="keyword">await</span> webLogin(&#123; code &#125;); <span class="comment">// 根据code,让后端获取登录信息</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="后端需要做的"><a href="#后端需要做的" class="headerlink" title="后端需要做的"></a>后端需要做的</h3><p><strong>后端需要自己看文档</strong><br><a href="https://developers.weixin.qq.com/doc/offiaccount/OA_Web_Apps/Wechat_webpage_authorization.html" target="_blank" rel="noopener">微信官方文档</a></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/10/22/微信生态圈这点事儿(微信H5支付)/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="NicolasSingle">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="佛系编程">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/10/22/微信生态圈这点事儿(微信H5支付)/" itemprop="url">微信生态圈这点事儿(微信H5支付)</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2019-10-22T00:00:00+08:00">
                2019-10-22
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="微信H5支付"><a href="#微信H5支付" class="headerlink" title="微信H5支付"></a>微信H5支付</h2><ul>
<li><p>微信内部支付(jsapi支付)</p>
</li>
<li><p>微信外部浏览器H5支付(MWEB支付)</p>
</li>
</ul>
<p><strong>起源:</strong> 为了展示公司价值<del>为了让公司生存</del>, 为了公司理想和抱负<del>为了养活公司上下老小</del>, 达成产品变现的伟大前景, 领导决定需要接入H5微信支付。  </p>
<p><strong>微信支付官方文档</strong><br><a href="https://pay.weixin.qq.com/wiki/doc/api/index.html" target="_blank" rel="noopener">微信支付文档</a></p>
<h3 id="产品需要做的"><a href="#产品需要做的" class="headerlink" title="产品需要做的"></a>产品需要做的</h3><ol>
<li>设置支付目录<br><strong>(请确保实际支付时的请求目录与后台配置的目录一致（现在已经支持配置根目录，配置后有一定的生效时间，一般5分钟内生效），否则将无法成功唤起微信支付。)</strong><br>在微信商户平台（pay.weixin.qq.com）设置您的JSAPI支付支付目录，设置路径：商户平台–&gt;产品中心–&gt;开发配置，如图7.7所示。JSAPI支付在请求支付的时候会校验请求来源是否有在商户平台做了配置，所以必须确保支付目录已经正确的被配置，否则将验证失败，请求支付不成功。<br><img src="https://pay.weixin.qq.com/wiki/doc/api/img/chapter7_3_1.png" alt="支付目录"></li>
<li>设置授权域名<br>开发JSAPI支付时，在统一下单接口中要求必传用户openid，而获取openid则需要您在公众平台设置获取openid的域名，只有被设置过的域名才是一个有效的获取openid的域名，否则将获取失败。<br><img src="https://pay.weixin.qq.com/wiki/doc/api/img/chapter7_3_2.png" alt="公众号设置"><br><img src="https://pay.weixin.qq.com/wiki/doc/api/img/chapter7_3_3.png" alt="网页授权域名"></li>
</ol>
<blockquote>
<p>Talk is cheap. Show me the code.</p>
</blockquote>
<h3 id="前端需要做-敲-的"><a href="#前端需要做-敲-的" class="headerlink" title="前端需要做(敲)的"></a>前端需要做(敲)的</h3><p><strong>微信登录分为两种:</strong> jsapi支付和微信H5支付</p>
<ul>
<li><p>jsapi支付<br>JSAPI支付是用户在微信中打开商户的H5页面，商户在H5页面通过调用微信支付提供的JSAPI接口调起微信支付模块完成支付。应用场景有：</p>
<ul>
<li>用户在微信公众账号内进入商家公众号，打开某个主页面，完成支付</li>
<li>用户的好友在朋友圈、聊天窗口等分享商家页面连接，用户点击链接打开商家页面，完成支付</li>
<li>将商户页面转换成二维码，用户扫描二维码后在微信浏览器中打开页面后完成支付</li>
</ul>
</li>
<li><p>微信H5支付<br>H5支付主要是在手机、ipad等移动设备中通过浏览器来唤起微信支付的支付产品。</p>
</li>
</ul>
<h3 id="jsapi支付以及微信H5支付"><a href="#jsapi支付以及微信H5支付" class="headerlink" title="jsapi支付以及微信H5支付"></a>jsapi支付以及微信H5支付</h3><p><strong>具体代码:</strong><br>utils-login.js</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> payUtil = &#123;</span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 当微信js bridge 准备好时  发起微信内部浏览器的微信支付</span></span><br><span class="line"><span class="comment">   * @param &#123;object&#125; data 后端发起订单之后返回的参数</span></span><br><span class="line"><span class="comment">   * @param &#123;function&#125; callback 支付完成后的回调函数</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  onBridgeReady (data, callback) &#123;</span><br><span class="line">    WeixinJSBridge.invoke(</span><br><span class="line">      <span class="string">'getBrandWCPayRequest'</span>, &#123;</span><br><span class="line">          <span class="string">"appId"</span>: webappid,                   <span class="comment">// appid</span></span><br><span class="line">          <span class="string">"timeStamp"</span>: data.timeStamp,   <span class="comment">// 时间戳</span></span><br><span class="line">          <span class="string">"nonceStr"</span>: data.nonceStr,        <span class="comment">// 随机串</span></span><br><span class="line">          <span class="string">"package"</span>: data.package,     </span><br><span class="line">          <span class="string">"signType"</span>:<span class="string">"MD5"</span>,                    <span class="comment">// 微信签名方式：     </span></span><br><span class="line">          <span class="string">"paySign"</span>: data.paySign <span class="comment">// 微信签名 </span></span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="function"><span class="keyword">function</span> (<span class="params">res</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (res.err_msg == <span class="string">"get_brand_wcpay_request:ok"</span>) &#123;</span><br><span class="line">          <span class="comment">// JS API的返回结果get_brand_wcpay_request:ok仅在用户成功完成支付时返回。</span></span><br><span class="line">          <span class="comment">// 由于前端交互复杂，get_brand_wcpay_request:cancel或者get_brand_wcpay_request:fail可以统一处理为用户遇到错误或者主动放弃，不必细化区分。</span></span><br><span class="line">          setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">            <span class="comment">// 因为无法判断是否支付完成,所以在此添加一个弹窗,让用户自己手动点击</span></span><br><span class="line">            mini.showModal(&#123;</span><br><span class="line">              title: <span class="string">"提示"</span>,</span><br><span class="line">              content: <span class="string">"请确认支付是否已完成?"</span>,</span><br><span class="line">              showCancel: <span class="literal">true</span>,</span><br><span class="line">              cancelText: <span class="string">"重新支付"</span>,</span><br><span class="line">              cancelColor: <span class="string">"#cccccc"</span>,</span><br><span class="line">              confirmText: <span class="string">"支付完成"</span>,</span><br><span class="line">              confirmColor: <span class="string">"#fd566a"</span>,</span><br><span class="line">              success: <span class="function"><span class="keyword">function</span> (<span class="params">res</span>) </span>&#123;</span><br><span class="line">                <span class="keyword">if</span> (res.confirm) &#123;</span><br><span class="line">                  <span class="keyword">if</span> (callback) callback();</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                  <span class="keyword">if</span> (callback) callback();</span><br><span class="line">                &#125;</span><br><span class="line">              &#125;</span><br><span class="line">            &#125;)</span><br><span class="line">          &#125;, <span class="number">1000</span>)</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    );</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 外部js直接发起微信浏览器内进行的微信支付</span></span><br><span class="line"><span class="comment">   * @param &#123;object&#125; data 后端发起订单之后返回的参数</span></span><br><span class="line"><span class="comment">   * @param &#123;function&#125; callback 支付完成后的回调函数</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  wechatH5Payment (data, callback) &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">typeof</span> WeixinJSBridge == <span class="string">"undefined"</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> ( <span class="built_in">document</span>.addEventListener ) &#123;</span><br><span class="line">            <span class="built_in">document</span>.addEventListener(<span class="string">'WeixinJSBridgeReady'</span>, <span class="keyword">this</span>.onBridgeReady(data, callback), <span class="literal">false</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="built_in">document</span>.attachEvent) &#123;</span><br><span class="line">            <span class="built_in">document</span>.attachEvent(<span class="string">'WeixinJSBridgeReady'</span>, <span class="keyword">this</span>.onBridgeReady(data, callback)); </span><br><span class="line">            <span class="built_in">document</span>.attachEvent(<span class="string">'onWeixinJSBridgeReady'</span>, <span class="keyword">this</span>.onBridgeReady(data, callback));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">this</span>.onBridgeReady(data, callback);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 外部js直接发起微信外浏览器进行微信支付</span></span><br><span class="line"><span class="comment">   * @param &#123;object&#125; data 后端发起订单之后返回的参数</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  wechatWapPayment (data) &#123;</span><br><span class="line">      <span class="keyword">let</span> href = <span class="built_in">window</span>.location.href;</span><br><span class="line">      href = <span class="built_in">encodeURIComponent</span>(addParamsToEnd(href, &#123;<span class="attr">key</span>: <span class="string">'beanTranNo'</span>, <span class="attr">val</span>: data.beanTranNo&#125;))</span><br><span class="line">      <span class="built_in">window</span>.location.href = data.mweb_url + <span class="string">'&amp;redirect_url='</span> + href</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 添加参数到url尾部</span></span><br><span class="line"><span class="comment"> * @param &#123;string&#125; url 需要拼参数的url</span></span><br><span class="line"><span class="comment"> * @param &#123;obj&#125; params 需要拼到末尾的参数  包含key和val</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">const</span> addParamsToEnd = <span class="function">(<span class="params">url, params</span>) =&gt;</span> url.match(<span class="regexp">/[?]/</span>) ? url + <span class="string">'&amp;'</span> + params.key + <span class="string">'='</span> + params.val : url + <span class="string">'?'</span> + params.key + <span class="string">'='</span> + params.val;</span><br></pre></td></tr></table></figure>
<h4 id="解析"><a href="#解析" class="headerlink" title="解析"></a>解析</h4><ul>
<li><p>微信jsapi支付流程  </p>
<ol>
<li>调取后端下单接口生成订单</li>
<li>网页内请求生成支付订单</li>
<li>后端生成商户订单</li>
<li>后端调用微信下单api</li>
<li>微信支付系统生成预付单,并返回给后端预付单信息(prepay_id)</li>
<li>生成jsapi页面调用的支付参数并签名, 返回支付参数给前端</li>
<li>用户点击发起支付, jsapi接口请求微信支付系统进行支付</li>
<li>微信支付系统检查参数是否合法以及授权域名权限, 返回检验结果并请求授权支付</li>
<li>用户输入密码确认支付, 提交支付授权到微信支付系统, 微信支付系统验证授权</li>
<li>微信支付系统异步通知后端支付结果</li>
<li>后端告知微信支付系统处理结果</li>
<li>前端展示支付消息给用户, 并跳转到指定页面</li>
<li>前端查询后端支付结果</li>
<li>后端调用查询api, 查询支付结果, 微信支付系统返回支付结果</li>
<li>后端返回支付结果到前端, 前端对其进行处理<br><strong>前端主要是发起微信支付系统支付以及和后端交互,加密签名等隐私操作需要后端执行</strong>  </li>
</ol>
</li>
<li><p>微信H5支付流程  </p>
<ol>
<li>调取后端下单接口生成订单</li>
<li>后端生成商户订单, 返回后端URL</li>
<li>后端返回给前端URL, 前端URL跳转到指定页面(需要自己拼上回调链接用于接收订单支付结果)</li>
<li>微信支付后台自己操作一波返回校验结果, 校验成功后deeplink调起微信客户端</li>
<li>微信客户端内支付完成, 微信支付后台主动去找后端发送支付通知, 后端返回接收结果</li>
<li>微信客户端支付后, 会再次调起原浏览器, 跳转到目标页面</li>
<li>前端在目标页面获取到参数(订单号)后, 调取后端接口查询支付结果</li>
<li>后端判断是否支付成功, 返回前端支付结果</li>
<li>前端根据不同结果展示不同样式<br><strong>前端主要在这里完成一个跳转打开微信客户端和拼接链接页面,在相关页面进行参数处理的工作,前端需要在回调页面加载后判断url上是否包含指定参数,来进行后续操作,否则无法完成整个闭环</strong></li>
</ol>
</li>
</ul>
<h3 id="后端需要做的"><a href="#后端需要做的" class="headerlink" title="后端需要做的"></a>后端需要做的</h3><p><strong>后端需要自己看文档</strong><br><a href="https://pay.weixin.qq.com/wiki/doc/api/H5.php?chapter=9_20&amp;index=1" target="_blank" rel="noopener">微信H5支付文档</a><br><a href="https://pay.weixin.qq.com/wiki/doc/api/jsapi.php?chapter=9_1" target="_blank" rel="noopener">微信jsapi支付文档</a></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/10/21/微信生态圈这点事儿(微信H5分享)/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="NicolasSingle">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="佛系编程">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/10/21/微信生态圈这点事儿(微信H5分享)/" itemprop="url">微信生态圈这点事儿(微信H5分享)</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2019-10-21T00:00:00+08:00">
                2019-10-21
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="分享H5链接的图形化展示"><a href="#分享H5链接的图形化展示" class="headerlink" title="分享H5链接的图形化展示"></a>分享H5链接的图形化展示</h2><p><img src="https://img2018.cnblogs.com/blog/1244003/201811/1244003-20181102101438689-1611226057.png" alt="blockchain" title="分享卡片"><br>这种分享卡片将链接以一种用户一眼就能看懂得样式进行展示, 内部的标题title, 描述describe, 缩略图img均可以通过前端调取微信jsapi完成效果</p>
<h3 id="分享H5链接的图形化展示形式"><a href="#分享H5链接的图形化展示形式" class="headerlink" title="分享H5链接的图形化展示形式"></a>分享H5链接的图形化展示形式</h3><p><strong>起源:</strong> 做内容宣发类产品, 用户体验一定要最好, 最期望的效果是用户一看到这种H5分享卡片就有一种想打开的冲动, 以此来吸引用户, 增加流量, 实现产品的<del>诱导用户分享</del>完美闭环。于是产品经理为了达到这种美好愿景, <del>威胁</del>恳求我完成这个<del>坑人</del>美好需求。</p>
<h4 id="产品需要做的"><a href="#产品需要做的" class="headerlink" title="产品需要做的"></a>产品需要做的</h4><ol>
<li>微信认证过的公众号:必须是经过认证的，没有认证的或者认证过期的都不可以；</li>
<li>经过备案的域名：必须是备案过的，不然是无法使用的；</li>
<li>绑定域名：首先你需要将需要分享的网址的域名绑定到微信公众平台上面，具体操作：先登录微信公众平台进入“公众号设置”的“功能设置”里填写“JS接口安全域名”；</li>
<li>需要在微信后台进入“开发”的IP白名单里添加一个后端服务器的ip，<br>通过开发者ID及密码调用获取access_token接口时，需要设置访问来源IP为白名单。</li>
</ol>
<h4 id="前端需要做的"><a href="#前端需要做的" class="headerlink" title="前端需要做的"></a>前端需要做的</h4><ol>
<li><p>引入jweixin.js</p>
<ul>
<li>npm引入<code>npm i weixin-js-sdk</code></li>
<li>外部js文件引入<code>&lt;script src=&quot;https://res.wx.qq.com/open/js/jweixin-1.0.0.js&quot;&gt;&lt;/script&gt;</code></li>
</ul>
</li>
<li><p>通过ajax获取参数 :通过后台给你的接口，取到那些必要的参数，然后你需要把当前分享的页面的url传到后台去，必须动态的获取当前页面，而且一定要对url进行编码，要不然会不起作用；</p>
</li>
<li><p>因为重复上线你手机需要清理缓存，这又是一个麻烦事，手机打开：<br><a href="debugx5.qq.com">debugx5.qq.com</a><br>然后滑到底部，有四个清理缓存的选择框，选择清理就好，不会影响别的地方的缓存，无需担心；</p>
</li>
<li>前端需要敲代码了<br>utils.js</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> wx <span class="keyword">from</span> <span class="string">"weixin-js-sdk"</span>;</span><br><span class="line"><span class="keyword">import</span> Api <span class="keyword">from</span> <span class="string">"../api/api"</span>; <span class="comment">// 后端接口</span></span><br><span class="line"><span class="keyword">const</span> appid = <span class="string">"appid"</span>; <span class="comment">// 自己的appid</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> wxJssdk = <span class="keyword">async</span> (title, desc, imgUrl) =&gt; &#123;</span><br><span class="line">  <span class="keyword">let</span> url = <span class="built_in">window</span>.location.href.split(<span class="string">"#"</span>)[<span class="number">0</span>]; <span class="comment">// 获取锚点之前的链接</span></span><br><span class="line">  <span class="keyword">if</span> (url.indexOf(<span class="string">"?"</span>) &gt;= <span class="number">0</span>) &#123;</span><br><span class="line">    url = url.split(<span class="string">"?"</span>)[<span class="number">0</span>]</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">const</span> links = <span class="built_in">window</span>.location.href;</span><br><span class="line">  <span class="keyword">const</span> res = <span class="keyword">await</span> Api.shareSign(&#123;appid, url&#125;);</span><br><span class="line">  <span class="keyword">const</span> signature = res.data.data.signature.toLowerCase();</span><br><span class="line">  </span><br><span class="line">  wx.config(&#123;</span><br><span class="line">    debug: <span class="literal">false</span>,</span><br><span class="line">    appId: appid,</span><br><span class="line">    jsapi_ticket: res.data.data.jsapi_ticket,</span><br><span class="line">    timestamp: res.data.data.timestamp,</span><br><span class="line">    nonceStr: res.data.data.noncestr,</span><br><span class="line">    signature: signature,</span><br><span class="line">    jsApiList: [</span><br><span class="line">      <span class="string">"onMenuShareTimeline"</span>,</span><br><span class="line">      <span class="string">"onMenuShareAppMessage"</span>,</span><br><span class="line">      <span class="string">"onMenuShareQQ"</span>,</span><br><span class="line">      <span class="string">"onMenuShareWeibo"</span>,</span><br><span class="line">      <span class="string">"onMenuShareQZone"</span></span><br><span class="line">    ]</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  wx.ready(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    wx.onMenuShareTimeline(&#123;</span><br><span class="line">      title: title, <span class="comment">// 分享标题</span></span><br><span class="line">      desc: desc, <span class="comment">// 分享描述</span></span><br><span class="line">      link: links, <span class="comment">// 分享链接</span></span><br><span class="line">      imgUrl: imgUrl, <span class="comment">// 分享图标</span></span><br><span class="line">      success: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;&#125;,</span><br><span class="line">      cancel: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;&#125;</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="comment">// 微信分享菜单测试</span></span><br><span class="line">    wx.onMenuShareAppMessage(&#123;</span><br><span class="line">      title: title, <span class="comment">// 分享标题</span></span><br><span class="line">      desc: desc, <span class="comment">// 分享描述</span></span><br><span class="line">      link: links, <span class="comment">// 分享链接</span></span><br><span class="line">      imgUrl: imgUrl, <span class="comment">// 分享图标</span></span><br><span class="line">      success: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;&#125;,</span><br><span class="line">      cancel: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;&#125;</span><br><span class="line">    &#125;);</span><br><span class="line">    wx.onMenuShareQQ(&#123;</span><br><span class="line">      title: title, <span class="comment">// 分享标题</span></span><br><span class="line">      desc: desc, <span class="comment">// 分享描述</span></span><br><span class="line">      link: links, <span class="comment">// 分享链接</span></span><br><span class="line">      imgUrl: imgUrl, <span class="comment">// 分享图标</span></span><br><span class="line">      success: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;&#125;,</span><br><span class="line">      cancel: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;&#125;</span><br><span class="line">    &#125;);</span><br><span class="line">    wx.onMenuShareWeibo(&#123;</span><br><span class="line">      title: title, <span class="comment">// 分享标题</span></span><br><span class="line">      desc: desc, <span class="comment">// 分享描述</span></span><br><span class="line">      link: links, <span class="comment">// 分享链接</span></span><br><span class="line">      imgUrl: imgUrl, <span class="comment">// 分享图标</span></span><br><span class="line">      success: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;&#125;,</span><br><span class="line">      cancel: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;&#125;</span><br><span class="line">    &#125;);</span><br><span class="line">    wx.onMenuShareQZone(&#123;</span><br><span class="line">      title: title, <span class="comment">// 分享标题</span></span><br><span class="line">      desc: desc, <span class="comment">// 分享描述</span></span><br><span class="line">      link: links, <span class="comment">// 分享链接</span></span><br><span class="line">      imgUrl: imgUrl, <span class="comment">// 分享图标</span></span><br><span class="line">      success: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;&#125;,</span><br><span class="line">      cancel: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;&#125;</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;);</span><br><span class="line">  wx.error(<span class="function"><span class="keyword">function</span>(<span class="params">err</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="built_in">JSON</span>.stringify(err));</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>share.vue</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wxJssdk(title, describe, picUrl)</span><br></pre></td></tr></table></figure>
<h4 id="后端需要做的"><a href="#后端需要做的" class="headerlink" title="后端需要做的"></a>后端需要做的</h4><p>告诉后端让后端自己看文档!</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/08/23/jQuery源码分析/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="NicolasSingle">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="佛系编程">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/08/23/jQuery源码分析/" itemprop="url">jQuery源码分析</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-08-23T11:34:10+08:00">
                2018-08-23
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="解析jQuery2-0-3"><a href="#解析jQuery2-0-3" class="headerlink" title="解析jQuery2.0.3"></a>解析jQuery2.0.3</h2><ul>
<li>第52行</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">class2type = &#123;&#125;,</span><br><span class="line">core_deletedIds = [],</span><br><span class="line">core_concat = core_deletedIds.concat,</span><br><span class="line">core_push = core_deletedIds.push,</span><br><span class="line">core_slice = core_deletedIds.slice,</span><br><span class="line">core_indexOf = core_deletedIds.indexOf,</span><br><span class="line">core_toString = class2type.toString,</span><br><span class="line">core_hasOwn = class2type.hasOwnProperty,</span><br><span class="line">core_trim = core_version.trim</span><br></pre></td></tr></table></figure>
<h2 id="利用了原生的很多方法-这里直接偷梁换柱-例如"><a href="#利用了原生的很多方法-这里直接偷梁换柱-例如" class="headerlink" title="利用了原生的很多方法,这里直接偷梁换柱,例如"></a>利用了原生的很多方法,这里直接偷梁换柱,例如</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">toArray: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">	<span class="keyword">return</span> core_slice.call( <span class="keyword">this</span> );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="那是相当的鸡贼啊-直接把原生的方法赋值过去-然后换上jq对象-成为自己的方法-从这里边能学到的东西就是call这个方法-能够改变this的指向"><a href="#那是相当的鸡贼啊-直接把原生的方法赋值过去-然后换上jq对象-成为自己的方法-从这里边能学到的东西就是call这个方法-能够改变this的指向" class="headerlink" title="那是相当的鸡贼啊,直接把原生的方法赋值过去,然后换上jq对象,成为自己的方法,从这里边能学到的东西就是call这个方法,能够改变this的指向"></a>那是相当的鸡贼啊,直接把原生的方法赋值过去,然后换上jq对象,成为自己的方法,从这里边能学到的东西就是call这个方法,能够改变this的指向</h2><h2 id="关于call的用法"><a href="#关于call的用法" class="headerlink" title="关于call的用法"></a>关于call的用法</h2><p>类似bind能够改变this的指向<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> obj = &#123;<span class="attr">name</span>:<span class="string">'NicolasSingle'</span>&#125;;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">fn</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="keyword">this</span>);</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="keyword">this</span>.name);</span><br><span class="line">&#125;</span><br><span class="line">fn();</span><br><span class="line">fn.call(obj);</span><br></pre></td></tr></table></figure></p>
<p>这样首先寻找call方法,最后通过原型链找到call,然后让call执行,执行call的时候,让fn的this变成传入的第一个参数obj,以此改变this指向。</p>
<h1 id="经典例子："><a href="#经典例子：" class="headerlink" title="经典例子："></a>经典例子：</h1><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">fn1</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="number">1</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">fn2</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="number">2</span>);</span><br><span class="line">&#125;</span><br><span class="line">fn1.call(fn2); <span class="comment">// 1</span></span><br><span class="line">fn1.call.call(fn2); <span class="comment">// 2</span></span><br></pre></td></tr></table></figure>
<p>这里第一个结果,依旧是执行fn1虽然改变了fn1的this指向,并且是指向了fn2,然后执行fn1,输出1,没毛病<br>这里第二个结果,已经是先执行改变了fn1.call的this指向,并且指向了fn2,然后也就是说fn1.call再执行,执行的时候里边的this()方法,this()方法 就是指向的this方法,那就是执行fn2</p>
<h1 id="hack的意思是兼容"><a href="#hack的意思是兼容" class="headerlink" title="hack的意思是兼容"></a>hack的意思是兼容</h1><p>css的hack手法一般都是对不同浏览器进行不同的hack处理 就是兼容处理,JavaScript也有很多hack方法,举几个有趣的例子<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">javascript:<span class="built_in">document</span>.body.contentEditable=<span class="string">'true'</span>;<span class="built_in">document</span>.designMode=<span class="string">'on'</span>; <span class="keyword">void</span>(<span class="number">0</span>);</span><br></pre></td></tr></table></figure></p>
<p>放到控制台输入这段代码,就可以直接在浏览器编辑网页内容<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">javascript:R=<span class="number">0</span>; x1=<span class="number">.1</span>; y1=<span class="number">.05</span>; x2=<span class="number">.25</span>; y2=<span class="number">.24</span>; x3=<span class="number">1.6</span>; y3=<span class="number">.24</span>; x4=<span class="number">300</span>; y4=<span class="number">200</span>; x5=<span class="number">300</span>; y5=<span class="number">200</span>; DI=<span class="built_in">document</span>.images; DIL=DI.length; <span class="function"><span class="keyword">function</span> <span class="title">A</span>(<span class="params"></span>)</span>&#123;<span class="keyword">for</span>(i=<span class="number">0</span>; i-DIL; i++)&#123;DIS=DI[ i ].style; DIS.position=<span class="string">'absolute'</span>; DIS.left=(<span class="built_in">Math</span>.sin(R*x1+i*x2+x3)*x4+x5)+<span class="string">"px"</span>; DIS.top=(<span class="built_in">Math</span>.cos(R*y1+i*y2+y3)*y4+y5)+<span class="string">"px"</span>&#125;R++&#125;setInterval(<span class="string">'A()'</span>,<span class="number">5</span>); <span class="keyword">void</span>(<span class="number">0</span>);</span><br></pre></td></tr></table></figure></p>
<p>这段hack代码可以让网页中的图片舞动起来<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">javascript:(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;<span class="keyword">var</span> s,F,j,f,i;s=<span class="string">""</span>;F=<span class="built_in">document</span>.forms;<span class="keyword">for</span>(j=<span class="number">0</span>;j&lt;F.length;++j)&#123;f=F[j];<span class="keyword">for</span>(i=<span class="number">0</span>;i&lt;f.length;++i)&#123;<span class="keyword">if</span>(f[i].type.toLowerCase()==<span class="string">"password"</span>)s+=f[i].value+<span class="string">"\n"</span>;&#125;&#125;<span class="keyword">if</span>(s)alert(<span class="string">"Passwords in forms on this page:\n\n"</span>+s);<span class="keyword">else</span> alert(<span class="string">"There are no passwords in forms on this page."</span>);&#125;)();</span><br></pre></td></tr></table></figure></p>
<p>这段hack代码可以显示password的内容,就是说可以看input密文的密码变明文</p>
<h1 id="pushStack-入栈方法"><a href="#pushStack-入栈方法" class="headerlink" title="pushStack 入栈方法"></a>pushStack 入栈方法</h1><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Take an array of elements and push it onto the stack</span></span><br><span class="line"><span class="comment">// (returning the new matched element set)</span></span><br><span class="line">pushStack: <span class="function"><span class="keyword">function</span>(<span class="params"> elems </span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// Build a new jQuery matched element set</span></span><br><span class="line">	<span class="keyword">var</span> ret = jQuery.merge( <span class="keyword">this</span>.constructor(), elems );</span><br><span class="line"></span><br><span class="line">	<span class="comment">// Add the old object onto the stack (as a reference)</span></span><br><span class="line">	ret.prevObject = <span class="keyword">this</span>;</span><br><span class="line">	ret.context = <span class="keyword">this</span>.context;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// Return the newly-formed element set</span></span><br><span class="line">	<span class="keyword">return</span> ret;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这个方法在jQuery中经常使用,官方翻译的意思大概是把一个数组元素放到一个栈里<br>this.constructor就是jQuery中的jQuery对象,他这种写法是将jQuery对象模拟成构造函数,他和被选中的数组进行合并,放到这个栈里使用。听上去很难理解，其实这个就是实现jQuery对象的链式操作的。</p>
<h1 id="举个例子"><a href="#举个例子" class="headerlink" title="举个例子"></a>举个例子</h1><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$(<span class="string">'.demoDiv'</span>).children(<span class="string">'span'</span>).css(<span class="string">"color"</span>,<span class="string">"#666"</span>);</span><br></pre></td></tr></table></figure>
<p>这里的操作是实现的选中的demoDiv类标签,并对该标签的子标签,也就是span标签进行css样式更改</p>
<h1 id="jQuery中的例子"><a href="#jQuery中的例子" class="headerlink" title="jQuery中的例子"></a>jQuery中的例子</h1><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">slice: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">	<span class="keyword">return</span> <span class="keyword">this</span>.pushStack( core_slice.apply( <span class="keyword">this</span>, <span class="built_in">arguments</span> ) );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这个jQuery中的slice的操作就是把原生的slice通过封装实现了jQuery的链式操作,并且结合上边的”借鸡下蛋”的骚操作,直接把原生和他的jQuery对象通过apply继承到了一起,很有意思。</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/08/23/hello-world/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="NicolasSingle">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="佛系编程">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/08/23/hello-world/" itemprop="url">Hello World er</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-08-23T11:11:38+08:00">
                2018-08-23
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>Welcome to <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a>! This is your very first post. Check <a href="https://hexo.io/docs/" target="_blank" rel="noopener">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href="https://hexo.io/docs/troubleshooting.html" target="_blank" rel="noopener">troubleshooting</a> or you can ask me on <a href="https://github.com/hexojs/hexo/issues" target="_blank" rel="noopener">GitHub</a>.</p>
<h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo new <span class="string">"My New Post"</span></span><br></pre></td></tr></table></figure>
<p>More info: <a href="https://hexo.io/docs/writing.html" target="_blank" rel="noopener">Writing</a></p>
<h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo server</span><br></pre></td></tr></table></figure>
<p>More info: <a href="https://hexo.io/docs/server.html" target="_blank" rel="noopener">Server</a></p>
<h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo generate</span><br></pre></td></tr></table></figure>
<p>More info: <a href="https://hexo.io/docs/generating.html" target="_blank" rel="noopener">Generating</a></p>
<h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo deploy</span><br></pre></td></tr></table></figure>
<p>More info: <a href="https://hexo.io/docs/deployment.html" target="_blank" rel="noopener">Deployment</a></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  


          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name">NicolasSingle</p>
              <p class="site-description motion-element" itemprop="description">前端小码农,没事看看源码,整整小程序,用用vue,研究研究webpack,学习学习node.js</p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">6</span>
                  <span class="site-state-item-name">posts</span>
                </a>
              </div>
            

            

            
              
              
              <div class="site-state-item site-state-tags">
                
                  <span class="site-state-item-count">4</span>
                  <span class="site-state-item-name">tags</span>
                
              </div>
            

          </nav>

          

          

          
          

          
          

          

        </div>
      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2019</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">NicolasSingle</span>

  
</div>


  <div class="powered-by">Powered by <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a></div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">Theme &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Muse</a> v5.1.4</div>




        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  

  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  





  

  

  

  
  

  

  

  

</body>
</html>
